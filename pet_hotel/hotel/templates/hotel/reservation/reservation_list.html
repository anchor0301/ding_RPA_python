{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load querystring_tag %}

{% block content %}
<div class="list-container">
  <div class="list-header d-flex justify-content-between align-items-center mb-3">
    <h1>예약 관리</h1>
    <form method="get" class="d-flex gap-2">
      {{ filter.form.q|as_crispy_field }}
      {{ filter.form.status|as_crispy_field }}
      {{ filter.form.reservation_date|as_crispy_field }}
      {{ filter.form.check_in|as_crispy_field }}
      {{ filter.form.check_out|as_crispy_field }}
      <button type="submit" class="btn btn-outline-primary">적용</button>
    </form>
  </div>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead>
        <tr>
          <th>#</th>
          <th>예약 ID</th>
          <th>고객명</th>
          <th>강아지명</th>
          <th>예약일</th>
          <th>체크인</th>
          <th>체크아웃</th>
          <th>상태</th>
          <th>편집</th>
        </tr>
      </thead>
      <tbody>
        {% for r in reservations %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ r.id }}</td>
          <td>{{ r.customer.name }}</td>
          <td>{{ r.dog.name }}</td>
          <td>{{ r.reservation_date }}</td>
          <td>{{ r.check_in|date:"Y-m-d" }}</td>
          <td>{{ r.check_out|date:"Y-m-d" }}</td>
          <td>
            {% if r.is_canceled %}
              <span class="badge bg-danger">취소</span>
            {% elif r.is_checked_out %}
              <span class="badge bg-secondary">퇴실 완료</span>
            {% elif r.is_checked_in %}
              <span class="badge bg-success">입실 중</span>
            {% else %}
              <span class="badge bg-warning text-dark">입실 전</span>
            {% endif %}
          </td>
          <td>
            <a href="{% url 'hotel:admin_reservation_detail' r.pk %}"    class="btn btn-sm btn-outline-primary">보기</a>
            <a href="{% url 'hotel:reservation_update' r.pk %}"    class="btn btn-sm btn-outline-secondary">수정</a>
            <a href="{% url 'hotel:reservation_delete' r.pk %}"    class="btn btn-sm btn-outline-danger">삭제</a>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="9" class="text-center py-3">예약 정보가 없습니다.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- 페이징 -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?{% querystring request.GET 'page' %}&page={{ page_obj.previous_page_number }}">Previous</a>
        </li>
      {% endif %}
      <li class="page-item active"><span class="page-link">{{ page_obj.number }}</span></li>
      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?{% querystring request.GET 'page' %}&page={{ page_obj.next_page_number }}">Next</a>
        </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
