{% extends "public_base.html" %}
{% load static %}


{% block extra_css %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
<link rel="stylesheet" href="{% static 'reservation/css/public_base.css' %}">
<link rel="stylesheet" href="{% static 'reservation/css/reservation_form.css' %}">
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<script src="{% static 'reservation/js/reservation_form.js' %}"></script>
{% endblock %}


{% block content %}
<div class="container mt-5">
    <h2>{{ customer.name }} λ‹μ μμ•½</h2>

    <form method="post" action="{% url 'customer:reservation_submit' customer.token %}" novalidate
          class="needs-validation" id="reservationForm">
        {% csrf_token %}
        <!-- λ°λ ¤κ²¬ μ„ νƒ -->
        <div class="mb-3 form-step visible" id="step-1">

            <p id="selectedDogCount" class="text-muted small mb-2">
                π¶ μ„ νƒλ λ°λ ¤κ²¬: 0λ§λ¦¬
            </p>

            <div class="dog-selection">
                {% for dog in customer.dogs.all %}
                <label class="dog-option">
                    <input type="checkbox" name="dog_ids" value="{{ dog.id }}">
                    <div class="dog-card">
                        <div class="dog-header">
                            <strong>{{ dog.name }}</strong>
                            <span class="badge">{{ dog.breed }}</span>
                        </div>
                        <div class="dog-gender">
                            {% if dog.gender == "M" %}
                            β™‚ μμ»·
                            {% else %}
                            β™€ μ•”μ»·
                            {% endif %}
                        </div>
                        <div class="check-icon">β“</div>
                    </div>
                </label>
                {% endfor %}

                <label class="dog-option">
                    <a href="{% url 'customer:register_dog' token=customer.token %}" class="btn">μ• κ²¬ μ¶”κ°€</a>
                </label>
            </div>

        </div>
        <!-- STEP 2: μ„λΉ„μ¤ μ„ νƒ -->
        <div id="step-2" class="form-step">
            <h4>2λ‹¨κ³„: μ„λΉ„μ¤ μ„ νƒ</h4>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="hotel"
                       id="serviceHotel">
                <label class="form-check-label" for="serviceHotel">π¨ νΈν…”λ§</label>
            </div>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="daycare"
                       id="serviceDaycare">
                <label class="form-check-label" for="serviceDaycare">πΎ μ μΉμ›</label>
            </div>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="playroom"
                       id="servicePlayroom">
                <label class="form-check-label" for="servicePlayroom">π  λ†€μ΄λ°©</label>
            </div>
        </div>
        <div class="form-step" id="step-3">
            <!-- μ…μ‹¤/ν‡΄μ‹¤ λ‚ μ§ -->
            <div class="date-time-picker-container" id="multi-day-picker" style="display: none;">
                <label for="date-range">πΎ νΈν…” μ…Β·ν‡΄μ‹¤ λ‚ μ§ μ„ νƒ</label>
                <input type="text" id="date-range" placeholder="μμ‹) 2025-03-01 ~ 2025-04-05 | μ…μ‹¤κ³Ό ν‡΄μ‹¤μ„ μ„ νƒν•΄μ£Όμ„Έμ”">
                <input type="hidden" name="check_in_date" id="check-in-date">
                <input type="hidden" name="check_out_date" id="check-out-date">

                <label for="check-in-time">π•’ μ…μ‹¤ μμ • μ‹κ°„</label>
                <input type="text" id="check-in-time" name="check_in_time" placeholder="ex) 10:00">

                <label for="check-out-time">π•’ ν‡΄μ‹¤ μμ • μ‹κ°„</label>
                <input type="text" id="check-out-time" name="check_out_time" placeholder="ex) 12:00">
            </div>

            <!-- λ†€μ΄λ°© μ „μ© -->
            <div class="date-time-picker-container" id="playroom-picker" style="display: none;">
                <label for="playroom-date">π  λ†€μ΄λ°© μ΄μ©μΌ</label>
                <input type="text" id="playroom-date" name="playroom_date" placeholder="μμ‹) 2025-03-01">

                <label for="playroom-start-time">π•’ μ…μ‹¤ μμ • μ‹κ°„</label>
                <input type="text" id="playroom-start-time" name="playroom_start_time" placeholder="ex) 10:00">

                <label for="playroom-end-time">π•’ ν‡΄μ‹¤ μμ • μ‹κ°„</label>
                <input type="text" id="playroom-end-time" name="playroom_end_time" placeholder="ex) 14:00">
            </div>


        </div>
        <!-- μ”μ²­μ‚¬ν•­ -->
        <div class="mb-4 form-step" id="step-4">
            <label for="notes" class="form-label">μ¶”κ°€ μ”μ²­μ‚¬ν•­</label>
            <textarea
                    class="form-control"
                    id="notes"
                    name="notes"
                    rows="3"
                    placeholder="μ) κ°μΈλ£Έ λ“± | μ—†μΌλ©΄ κ³µλ€ κ°€λ¥"
            ></textarea>
            <button type="submit" class="btn btn-primary btn-lg">
                μ μ¶ ν•κΈ°
            </button>
        </div>
    </form>
</div>

{% endblock %}