{% extends "public_base.html" %}
{% load static %}


{% block extra_css %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
<link rel="stylesheet" href="{% static 'reservation/css/public_base.css' %}">
<link rel="stylesheet" href="{% static 'reservation/css/reservation_form.css' %}">
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<script src="{% static 'reservation/js/reservation_form.js' %}"></script>
{% endblock %}


{% block content %}
<div class="container mt-5">
    <h2>{{ customer.name }} 님의 예약</h2>

    <form method="post" action="{% url 'customer:reservation_submit' customer.token %}" novalidate
          class="needs-validation" id="reservationForm">
        {% csrf_token %}
        <!-- 반려견 선택 -->
        <div class="mb-3 form-step visible" id="step-1">

            <p id="selectedDogCount" class="text-muted small mb-2">
                🐶 선택된 반려견: 0마리
            </p>

            <div class="dog-selection">
                {% for dog in customer.dogs.all %}
                <label class="dog-option">
                    <input type="checkbox" name="dog_ids" value="{{ dog.id }}">
                    <div class="dog-card">
                        <div class="dog-header">
                            <strong>{{ dog.name }}</strong>
                            <span class="badge">{{ dog.breed }}</span>
                        </div>
                        <div class="dog-gender">
                            {% if dog.gender == "M" %}
                            ♂ 수컷
                            {% else %}
                            ♀ 암컷
                            {% endif %}
                        </div>
                        <div class="check-icon">✓</div>
                    </div>
                </label>
                {% endfor %}

                <label class="dog-option">
                    <a href="{% url 'customer:register_dog' token=customer.token %}" class="btn">애견 추가</a>
                </label>
            </div>

        </div>
        <!-- STEP 2: 서비스 선택 -->
        <div id="step-2" class="form-step">
            <h4>2단계: 서비스 선택</h4>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="hotel"
                       id="serviceHotel">
                <label class="form-check-label" for="serviceHotel">🏨 호텔링</label>
            </div>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="daycare"
                       id="serviceDaycare">
                <label class="form-check-label" for="serviceDaycare">🐾 유치원</label>
            </div>
            <div class="form-check">
                <input class="form-check-input service-option" type="radio" name="service" value="playroom"
                       id="servicePlayroom">
                <label class="form-check-label" for="servicePlayroom">🎠 놀이방</label>
            </div>
        </div>
        <div class="form-step" id="step-3">
            <!-- 입실/퇴실 날짜 -->
            <div class="date-time-picker-container" id="multi-day-picker" style="display: none;">
                <label for="date-range">🐾 호텔 입·퇴실 날짜 선택</label>
                <input type="text" id="date-range" placeholder="예시) 2025-03-01 ~ 2025-04-05 | 입실과 퇴실을 선택해주세요">
                <input type="hidden" name="check_in_date" id="check-in-date">
                <input type="hidden" name="check_out_date" id="check-out-date">

                <label for="check-in-time">🕒 입실 예정 시간</label>
                <input type="text" id="check-in-time" name="check_in_time" placeholder="ex) 10:00">

                <label for="check-out-time">🕒 퇴실 예정 시간</label>
                <input type="text" id="check-out-time" name="check_out_time" placeholder="ex) 12:00">
            </div>

            <!-- 놀이방 전용 -->
            <div class="date-time-picker-container" id="playroom-picker" style="display: none;">
                <label for="playroom-date">🎠 놀이방 이용일</label>
                <input type="text" id="playroom-date" name="playroom_date" placeholder="예시) 2025-03-01">

                <label for="playroom-start-time">🕒 입실 예정 시간</label>
                <input type="text" id="playroom-start-time" name="playroom_start_time" placeholder="ex) 10:00">

                <label for="playroom-end-time">🕒 퇴실 예정 시간</label>
                <input type="text" id="playroom-end-time" name="playroom_end_time" placeholder="ex) 14:00">
            </div>


        </div>
        <!-- 요청사항 -->
        <div class="mb-4 form-step" id="step-4">
            <label for="notes" class="form-label">추가 요청사항</label>
            <textarea
                    class="form-control"
                    id="notes"
                    name="notes"
                    rows="3"
                    placeholder="예) 개인룸 등 | 없으면 공란 가능"
            ></textarea>
            <button type="submit" class="btn btn-primary btn-lg">
                제출 하기
            </button>
        </div>
    </form>
</div>

{% endblock %}