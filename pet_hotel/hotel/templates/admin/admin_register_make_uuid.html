{% extends 'base.html' %}

{% block content %}
<form id="start-form" method="post" action="{% url 'hotel:admin_register_customer' %}">
  {% csrf_token %}
  <input type="text" name="name" id="name" placeholder="ì´ë¦„" required>
  <input type="text" name="phone" id="phone" placeholder="ì „í™”ë²ˆí˜¸" required>

  <button type="submit">í™•ì¸</button>
  <button type="button" id="generate-link-btn">ğŸ”— ë§í¬ ìƒì„±</button>
</form>

<div id="link-result" class="mt-3" style="display: none;">
  <p>ğŸ“ ìƒì„±ëœ ë§í¬:</p>
  <input type="text" id="generated-url" class="form-control" readonly>
</div>
<script>
document.getElementById('generate-link-btn').addEventListener('click', async () => {
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

  if (!phone) {
    alert("ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
    return;
  }

  const response = await fetch("{% url 'hotel:generate_link' %}", {
    method: "POST",
    headers: {
      "Content-Type": "application/x-www-form-urlencoded",
      "X-CSRFToken": csrfToken
    },
    body: `name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}`
  });

  const data = await response.json();

  if (data.url) {
    const resultBox = document.getElementById('link-result');
    const urlInput = document.getElementById('generated-url');

    resultBox.style.display = 'block';
    urlInput.value = data.url;

    // âœ… ìë™ ë³µì‚¬
    urlInput.select();
    urlInput.setSelectionRange(0, 99999); // for mobile
    document.execCommand('copy');

    alert("ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹");
  }
});
</script>


{% endblock %}
